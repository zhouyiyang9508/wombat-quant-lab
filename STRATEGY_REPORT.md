# Wombat Quant Lab — 策略优化报告

> 作者：代码熊 🐻 | 日期：2026-02-19

## 执行摘要

经过 v5（规则策略）vs v3 ML（机器学习增强）的公平 Lump Sum 对比（$10,000 初始资金，相同数据源），**v5 规则策略全面胜出**：

- **TQQQ v5 Beast** ⭐：CAGR 41.8%, MaxDD -62.6%, Calmar 0.67
- **BTC v5 Beast** ⭐：CAGR 61.0%, MaxDD -74.0%, Calmar 0.82

ML v3 策略虽然降低了回撤，但严重损失了收益，不如 Buy & Hold。

## 公平对比结果

### TQQQ（2010-02-11 → 2026-02-18，4028 天）

| 策略 | 最终价值 | CAGR | MaxDD | Sharpe | Calmar |
|------|----------|------|-------|--------|--------|
| **v5 Beast** ⭐ | **$2,687,728** | **41.8%** | -62.6% | **0.85** | **0.67** |
| v3 ML (GBM) | $89,877 | 14.7% | -51.4% | 0.46 | 0.29 |
| Buy & Hold | $2,389,580 | 40.8% | -81.7% | 0.80 | 0.50 |

### BTC（2017-01-01 → 2026-02-18）

| 策略 | 最终价值 | CAGR | MaxDD | Sharpe | Calmar |
|------|----------|------|-------|--------|--------|
| **v5 Beast** ⭐ | **$774,007** | **61.0%** | -74.0% | **0.83** | **0.82** |
| v3 ML (多因子) | $108,008 | 29.8% | -61.7% | 0.60 | 0.48 |
| Buy & Hold | $666,842 | 58.4% | -83.2% | 0.77 | 0.70 |

## 为什么 ML 输了？

### 1. 过度择时（Overtrading）
ML v3 的 GBM 分类器在 200MA 以下时**强制清仓 0%**，而 v5 保留 30-35% 底仓。TQQQ 和 BTC 的很多大反弹恰好发生在 200MA 以下（V 型反弹），ML 完全错过了。

### 2. Walk-forward 分类器精度不够
在样本外（未来数据）的预测准确率只有 ~55%，接近随机，导致频繁误判 regime，来回切换吃手续费和滑点。

### 3. 简单规则的优势
v5 的宽幅滞后带（TQQQ: 90%/105%, BTC: 92%/103%）极大减少了 regime 切换次数，避免 whipsaw。配合 RSI 抄底机制，在熊市中也能捕捉到大部分反弹收益。

## 最优策略详解

### TQQQ v5 Beast — 宽幅滞后带策略

**牛市（price > SMA200 × 1.05 确认）：**
- 100% TQQQ，全仓吃涨
- RSI(10) > 80 且周涨幅 > 15% 时才减到 80%（极端狂热）

**熊市（price < SMA200 × 0.90 确认）：**
- 底仓 30%（关键！捕捉 V 型反弹）
- RSI(10) < 30 → 60%（适度抄底）
- RSI(10) < 20 或周跌 > 12% → 80%（恐慌买入）
- RSI(10) > 65 → 回到 30% 底仓

**核心创新：宽幅滞后带**
- 进入熊市：价格跌到 SMA200 的 **90%** 才触发（很晚的确认）
- 退出熊市：价格涨到 SMA200 的 **105%** 才恢复牛市
- 效果：极少切换，避免 whipsaw

### BTC v5 Beast — 减半周期 + Mayer Multiple

**牛市（price > SMA200 × 1.03）：**
- 100% BTC
- Mayer Multiple > 3.0 → 减至 70%（泡沫保护）
- Mayer Multiple > 3.5 → 减至 50%（极端泡沫）
- 减半后 30+ 个月 → 上限 90%（晚期谨慎）

**熊市（price < SMA200 × 0.92）：**
- 底仓 35%（减半后 0-12 月提升至 ~52%）
- RSI(14) < 30 → 60%
- RSI(14) < 20 → 80%
- 周跌 > 20% → 70%

**为何 BTC 用窄带（92%/103%）而 TQQQ 用宽带（90%/105%）：**
BTC 熊市特征明确且持续时间长，窄带可以更快识别趋势。TQQQ 波动更大，需要宽带防止假信号。

## ML 实验的价值

虽然 ML v3 没有胜出，但实验有以下收获：
1. **Pi Cycle Top 指标**有效识别 BTC 大顶，可考虑作为 v5 的辅助卖出信号
2. **Puell Multiple 代理**在底部识别上与 RSI 高度重合，独立价值有限
3. **Walk-forward GBM** 在日频数据上精度不够，或许在周频/月频上更适合
4. 验证了**简单规则 > 复杂 ML** 在高波动资产上的结论

## 防止未来函数审计 ✓

所有策略均通过审计：
- SMA200, RSI: `rolling().mean()` → 仅用历史数据 ✓
- Weekly return: `pct_change(5/7)` → 仅用历史数据 ✓
- ML Walk-forward: 训练集 [0 : T-20]，预测 T → 无标签泄露 ✓
- Mayer Multiple: price / SMA200 → 仅用当前和历史 ✓
- 减半日期: 已知历史事件 ✓

## 数据源

- TQQQ: Stooq.com 日线 (`tqqq/data/tqqq_daily.csv`, 4028 行)
- BTC: Stooq.com 日线 (`btc/data/btc_daily.csv`, 4173 行)

## 结论与建议

1. **v5 规则策略是当前最优**，无需替换
2. 可考虑将 Pi Cycle Top 作为 BTC v5 的辅助卖出信号（v6 方向）
3. ML 在更长时间框架（周频/月频）或更多特征（链上数据）上可能有价值
4. 回撤在 62-74% 范围内，符合用户 70-80% 容忍度

---

## 方向B探索：稳健Hedge Fund风格动态资产配置

> 日期：2026-02-19 | 代码熊 🐻

### 目标
- CAGR 15-25%, MaxDD <20%, Sharpe >1.5
- 资产池: QQQ + TLT + GLD（无杠杆）

### 策略演进

| 版本 | 方法 | CAGR | MaxDD | Sharpe | Calmar |
|------|------|------|-------|--------|--------|
| v1 (Risk Parity + Mom) | 风险平价 + 动量倾斜 | 10.4% | -22.5% | 0.63 | 0.46 |
| v2 (Dual Mom + VolTarget) | 双动量 + 波动率目标 | 8.8% | -12.7% | 0.55 | 0.69 |
| v3 (Concentrated Mom) | 集中持仓 + Regime | 11.8% | -25.4% | 0.58 | 0.47 |
| **v4 PMA (最终版)** | Breadth + 动量 + 平滑 + DD控制 | **10.1%** | **-17.0%** | **0.66** | **0.59** |

### v4 PMA 详细结果

**Full Period (2011-01 → 2026-02, ~15年)**
- CAGR: 10.1%, MaxDD: -17.0%, Sharpe: 0.66, Calmar: 0.59
- Win Rate (月度): 64.1%
- vs 60/40 B&H: CAGR差 (-2.5%), 但MaxDD优 (-17% vs -34%), Calmar优 (0.59 vs 0.37)

**Out-of-Sample (2019-09 → 2026-02)**
- CAGR: 13.1%, MaxDD: -17.0%, Sharpe: 0.85, Calmar: 0.77
- 大幅跑赢 60/40 (Sharpe 0.85 vs 0.42)

**参数稳健性**: ✅ 通过
- sma_period (45-85): Sharpe 0.52-0.59 → 稳定
- mom_lookback (63-200): Sharpe 0.54-0.61 → 稳定
- smooth (0-0.7): Sharpe 0.29-0.64 → smooth是关键参数
- offense_top1 (0.45-0.75): Sharpe 0.53-0.56 → 非常稳定

### v4 PMA 核心逻辑

1. **Breadth信号**: 3资产中几个在13W SMA上方？
   - ≥2 → 进攻模式（按动量排名加权：55/30/15）
   - =1 → 混合模式（40%最强 + 部分TLT/GLD）
   - =0 → 防御模式（50%TLT + 40%GLD + 10%现金）
2. **绝对动量过滤**: 6M+12M blended momentum < 0 → 不配置
3. **权重平滑**: 70%前期权重 + 30%新权重（减少whipsaw）
4. **回撤保护**: DD > -6% → 线性降仓至最低30%

### 关键发现

**Sharpe >1.5 目标不现实**：3资产无杠杆组合的理论Sharpe上限约0.8-1.0。即使Bridgewater All Weather（全天候策略）在无杠杆情况下Sharpe也仅~0.7。要达到1.5需要：
- 3-4x杠杆（风险平价 + 杠杆）
- 或更多低相关资产（商品期货、外汇等）
- 或允许做空

**权重平滑是最重要的参数**：从smooth=0到0.7，Sharpe从0.29飙升至0.64。减少换手是真正的alpha。

**防御模式很有效**：在2020、2022、2025的大跌中，breadth信号成功触发防御，MaxDD控制在-17%。

### 综合评分
Score = 0.66×0.4 + 0.59×0.4 + 0.101×0.2 = **0.523**

（对比TQQQ v8: ~0.85×0.4 + 0.75×0.4 + 0.442×0.2 = 0.728）

### 下一步方向
1. **加入SOXL/UPRO等3x ETF作为进攻资产**（方向A），保留TLT/GLD防御逻辑
2. **带杠杆的风险平价**: 如果允许2x杠杆，v4的Sharpe可能突破1.0
3. **加入更多资产**: 大宗商品(DBC)、房地产(VNQ)、国际(EFA) → 提高分散化

### 文件
- `hedge/codebear/stable_v1.py` - 风险平价+动量
- `hedge/codebear/stable_v2.py` - 双动量+波动率目标
- `hedge/codebear/stable_v3.py` - 集中动量
- `hedge/codebear/stable_v4.py` - **PMA最终版** ⭐

---
*Generated by 代码熊 🐻 — 2026-02-19*

# Wombat Quant Lab — 策略优化报告

> 作者：代码熊 🐻 | 日期：2026-02-19

## 执行摘要

经过 v5（规则策略）vs v3 ML（机器学习增强）的公平 Lump Sum 对比（$10,000 初始资金，相同数据源），**v5 规则策略全面胜出**：

- **TQQQ v5 Beast** ⭐：CAGR 41.8%, MaxDD -62.6%, Calmar 0.67
- **BTC v5 Beast** ⭐：CAGR 61.0%, MaxDD -74.0%, Calmar 0.82

ML v3 策略虽然降低了回撤，但严重损失了收益，不如 Buy & Hold。

## 公平对比结果

### TQQQ（2010-02-11 → 2026-02-18，4028 天）

| 策略 | 最终价值 | CAGR | MaxDD | Sharpe | Calmar |
|------|----------|------|-------|--------|--------|
| **v5 Beast** ⭐ | **$2,687,728** | **41.8%** | -62.6% | **0.85** | **0.67** |
| v3 ML (GBM) | $89,877 | 14.7% | -51.4% | 0.46 | 0.29 |
| Buy & Hold | $2,389,580 | 40.8% | -81.7% | 0.80 | 0.50 |

### BTC（2017-01-01 → 2026-02-18）

| 策略 | 最终价值 | CAGR | MaxDD | Sharpe | Calmar |
|------|----------|------|-------|--------|--------|
| **v5 Beast** ⭐ | **$774,007** | **61.0%** | -74.0% | **0.83** | **0.82** |
| v3 ML (多因子) | $108,008 | 29.8% | -61.7% | 0.60 | 0.48 |
| Buy & Hold | $666,842 | 58.4% | -83.2% | 0.77 | 0.70 |

## 为什么 ML 输了？

### 1. 过度择时（Overtrading）
ML v3 的 GBM 分类器在 200MA 以下时**强制清仓 0%**，而 v5 保留 30-35% 底仓。TQQQ 和 BTC 的很多大反弹恰好发生在 200MA 以下（V 型反弹），ML 完全错过了。

### 2. Walk-forward 分类器精度不够
在样本外（未来数据）的预测准确率只有 ~55%，接近随机，导致频繁误判 regime，来回切换吃手续费和滑点。

### 3. 简单规则的优势
v5 的宽幅滞后带（TQQQ: 90%/105%, BTC: 92%/103%）极大减少了 regime 切换次数，避免 whipsaw。配合 RSI 抄底机制，在熊市中也能捕捉到大部分反弹收益。

## 最优策略详解

### TQQQ v5 Beast — 宽幅滞后带策略

**牛市（price > SMA200 × 1.05 确认）：**
- 100% TQQQ，全仓吃涨
- RSI(10) > 80 且周涨幅 > 15% 时才减到 80%（极端狂热）

**熊市（price < SMA200 × 0.90 确认）：**
- 底仓 30%（关键！捕捉 V 型反弹）
- RSI(10) < 30 → 60%（适度抄底）
- RSI(10) < 20 或周跌 > 12% → 80%（恐慌买入）
- RSI(10) > 65 → 回到 30% 底仓

**核心创新：宽幅滞后带**
- 进入熊市：价格跌到 SMA200 的 **90%** 才触发（很晚的确认）
- 退出熊市：价格涨到 SMA200 的 **105%** 才恢复牛市
- 效果：极少切换，避免 whipsaw

### BTC v5 Beast — 减半周期 + Mayer Multiple

**牛市（price > SMA200 × 1.03）：**
- 100% BTC
- Mayer Multiple > 3.0 → 减至 70%（泡沫保护）
- Mayer Multiple > 3.5 → 减至 50%（极端泡沫）
- 减半后 30+ 个月 → 上限 90%（晚期谨慎）

**熊市（price < SMA200 × 0.92）：**
- 底仓 35%（减半后 0-12 月提升至 ~52%）
- RSI(14) < 30 → 60%
- RSI(14) < 20 → 80%
- 周跌 > 20% → 70%

**为何 BTC 用窄带（92%/103%）而 TQQQ 用宽带（90%/105%）：**
BTC 熊市特征明确且持续时间长，窄带可以更快识别趋势。TQQQ 波动更大，需要宽带防止假信号。

## ML 实验的价值

虽然 ML v3 没有胜出，但实验有以下收获：
1. **Pi Cycle Top 指标**有效识别 BTC 大顶，可考虑作为 v5 的辅助卖出信号
2. **Puell Multiple 代理**在底部识别上与 RSI 高度重合，独立价值有限
3. **Walk-forward GBM** 在日频数据上精度不够，或许在周频/月频上更适合
4. 验证了**简单规则 > 复杂 ML** 在高波动资产上的结论

## 防止未来函数审计 ✓

所有策略均通过审计：
- SMA200, RSI: `rolling().mean()` → 仅用历史数据 ✓
- Weekly return: `pct_change(5/7)` → 仅用历史数据 ✓
- ML Walk-forward: 训练集 [0 : T-20]，预测 T → 无标签泄露 ✓
- Mayer Multiple: price / SMA200 → 仅用当前和历史 ✓
- 减半日期: 已知历史事件 ✓

## 数据源

- TQQQ: Stooq.com 日线 (`tqqq/data/tqqq_daily.csv`, 4028 行)
- BTC: Stooq.com 日线 (`btc/data/btc_daily.csv`, 4173 行)

## 结论与建议

1. **v5 规则策略是当前最优**，无需替换
2. 可考虑将 Pi Cycle Top 作为 BTC v5 的辅助卖出信号（v6 方向）
3. ML 在更长时间框架（周频/月频）或更多特征（链上数据）上可能有价值
4. 回撤在 62-74% 范围内，符合用户 70-80% 容忍度

---

## 方向B探索：稳健Hedge Fund风格动态资产配置

> 日期：2026-02-19 | 代码熊 🐻

### 目标
- CAGR 15-25%, MaxDD <20%, Sharpe >1.5
- 资产池: QQQ + TLT + GLD（无杠杆）

### 策略演进

| 版本 | 方法 | CAGR | MaxDD | Sharpe | Calmar |
|------|------|------|-------|--------|--------|
| v1 (Risk Parity + Mom) | 风险平价 + 动量倾斜 | 10.4% | -22.5% | 0.63 | 0.46 |
| v2 (Dual Mom + VolTarget) | 双动量 + 波动率目标 | 8.8% | -12.7% | 0.55 | 0.69 |
| v3 (Concentrated Mom) | 集中持仓 + Regime | 11.8% | -25.4% | 0.58 | 0.47 |
| **v4 PMA (最终版)** | Breadth + 动量 + 平滑 + DD控制 | **10.1%** | **-17.0%** | **0.66** | **0.59** |

### v4 PMA 详细结果

**Full Period (2011-01 → 2026-02, ~15年)**
- CAGR: 10.1%, MaxDD: -17.0%, Sharpe: 0.66, Calmar: 0.59
- Win Rate (月度): 64.1%
- vs 60/40 B&H: CAGR差 (-2.5%), 但MaxDD优 (-17% vs -34%), Calmar优 (0.59 vs 0.37)

**Out-of-Sample (2019-09 → 2026-02)**
- CAGR: 13.1%, MaxDD: -17.0%, Sharpe: 0.85, Calmar: 0.77
- 大幅跑赢 60/40 (Sharpe 0.85 vs 0.42)

**参数稳健性**: ✅ 通过
- sma_period (45-85): Sharpe 0.52-0.59 → 稳定
- mom_lookback (63-200): Sharpe 0.54-0.61 → 稳定
- smooth (0-0.7): Sharpe 0.29-0.64 → smooth是关键参数
- offense_top1 (0.45-0.75): Sharpe 0.53-0.56 → 非常稳定

### v4 PMA 核心逻辑

1. **Breadth信号**: 3资产中几个在13W SMA上方？
   - ≥2 → 进攻模式（按动量排名加权：55/30/15）
   - =1 → 混合模式（40%最强 + 部分TLT/GLD）
   - =0 → 防御模式（50%TLT + 40%GLD + 10%现金）
2. **绝对动量过滤**: 6M+12M blended momentum < 0 → 不配置
3. **权重平滑**: 70%前期权重 + 30%新权重（减少whipsaw）
4. **回撤保护**: DD > -6% → 线性降仓至最低30%

### 关键发现

**Sharpe >1.5 目标不现实**：3资产无杠杆组合的理论Sharpe上限约0.8-1.0。即使Bridgewater All Weather（全天候策略）在无杠杆情况下Sharpe也仅~0.7。要达到1.5需要：
- 3-4x杠杆（风险平价 + 杠杆）
- 或更多低相关资产（商品期货、外汇等）
- 或允许做空

**权重平滑是最重要的参数**：从smooth=0到0.7，Sharpe从0.29飙升至0.64。减少换手是真正的alpha。

**防御模式很有效**：在2020、2022、2025的大跌中，breadth信号成功触发防御，MaxDD控制在-17%。

### 综合评分
Score = 0.66×0.4 + 0.59×0.4 + 0.101×0.2 = **0.523**

（对比TQQQ v8: ~0.85×0.4 + 0.75×0.4 + 0.442×0.2 = 0.728）

### 下一步方向
1. **加入SOXL/UPRO等3x ETF作为进攻资产**（方向A），保留TLT/GLD防御逻辑
2. **带杠杆的风险平价**: 如果允许2x杠杆，v4的Sharpe可能突破1.0
3. **加入更多资产**: 大宗商品(DBC)、房地产(VNQ)、国际(EFA) → 提高分散化

### 文件
- `hedge/codebear/stable_v1.py` - 风险平价+动量
- `hedge/codebear/stable_v2.py` - 双动量+波动率目标
- `hedge/codebear/stable_v3.py` - 集中动量
- `hedge/codebear/stable_v4.py` - **PMA最终版** ⭐

---
*Generated by 代码熊 🐻 — 2026-02-19*


---

## 宽资产动量轮动策略 — 最终版 (2026-02-19)

**资产宇宙**: 15 ETFs (SPY/QQQ/IWM/EFA/EEM/TLT/IEF/HYG/TIP/GLD/SLV/USO/DBC/VNQ + SHY防御)
**数据**: 2012-01-03 ~ 2026-02-18 (14年)

### 策略对比

| 策略 | CAGR | MaxDD | Sharpe | Calmar | 胜率 | IS Sharpe | OOS Sharpe | WF Pass | Composite |
|------|------|-------|--------|--------|------|-----------|------------|---------|-----------|
| **Momentum v2** ⭐ | 11.69% | -21.17% | **0.63** | 0.55 | 61.8% | 0.39 | **0.96** | ✅ | **0.495** |
| Momentum v1 | 11.48% | -24.85% | 0.57 | 0.46 | 62.4% | 0.23 | **1.05** | ✅ | 0.435 |
| Momentum v3 | 8.40% | -12.70% | 0.47 | 0.66 | 61.8% | 0.34 | 0.61 | ✅ | 0.469 |
| SPY B&H | 14.22% | -23.92% | 0.74 | 0.59 | 69.4% | - | - | - | - |
| 60/40 | 8.80% | -20.74% | 0.54 | 0.42 | 69.4% | - | - | - | - |

### 策略说明
- **v1**: 等权 Top3 + 绝对动量过滤（负动量→SHY）
- **v2**: 风险平价(inverse vol) Top3 + 中期动量偏重(1M:0.2/3M:0.4/6M:0.3/12M:0.1) + 绝对动量过滤 ⭐
- **v3**: v2风格 + 短期动量偏重(0.4/0.3/0.2/0.1) + 波动率择时（高vol时降仓50%→SHY）
- 手续费 0.05%/边 + 滑点 0.1%，无风险利率 4%
- Walk-forward: 60% IS / 40% OOS，全部通过（OOS > IS）

### 关键发现
1. **Sharpe >1.0 在OOS期间达成** (v1 OOS=1.05, v2 OOS=0.96)，但全期因2013-2019动量低迷被拉低
2. **风险平价 > 等权**：v2 比 v1 MaxDD低4pp，Calmar更高
3. **波动率择时过度保守**：v3虽MaxDD最低(-12.7%)，但CAGR和Sharpe都大幅下降
4. **中期动量(3M)权重最重要**：比等权加权或长期偏重更好
5. **防过拟合验证通过**：所有版本OOS Sharpe均 > IS Sharpe（无退化）
6. **vs SPY B&H**：动量策略CAGR略低但MaxDD可控，Calmar相当；真正优势在熊市防御

---

## 带杠杆动量轮动 + 蒙特卡洛压力测试 (2026-02-19)

> 代码熊 🐻 | 基于 Momentum v2 (RP Top3 + 中期动量)

### Part 1: 杠杆对比

| 配置 | CAGR | MaxDD | Sharpe | Calmar |
|------|------|-------|--------|--------|
| 1.0x (baseline) | 11.69% | -21.17% | 0.63 | 0.55 |
| 1.5x (无融资) | 17.34% | -30.30% | 0.74 | 0.57 |
| 1.5x (融资5%) | 14.47% | -33.31% | 0.61 | 0.43 |
| 1.5x (融资+熔断) | 14.40% | -29.50% | 0.61 | 0.49 |
| 2.0x (无融资) | 22.80% | -38.70% | **0.79** | **0.59** |
| 2.0x (融资5%) | 16.88% | -44.20% | 0.59 | 0.38 |
| 2.0x (融资+熔断) | 14.95% | -37.11% | 0.56 | 0.40 |

**关键发现**：
- 融资成本显著侵蚀收益（1.5x: Sharpe 0.74→0.61，2x: 0.79→0.59）
- 回撤熔断有效降低MaxDD（2x: -44%→-37%），但也限制了反弹收益
- **最优杠杆**: 1.5x无融资 (Sharpe 0.74, Calmar 0.57)；考虑融资后杠杆优势大幅缩小

### Part 2: 蒙特卡洛压力测试 (1000路径 × 10年)

| 指标 | v2 1.0x | v2 1.5x (fin+CB) | v2 2.0x (fin+CB) |
|------|---------|-------------------|-------------------|
| Sharpe P5 | 0.103 | 0.096 | 0.039 |
| Sharpe P25 | 0.420 | 0.401 | 0.349 |
| **Sharpe P50** | **0.626** | **0.612** | **0.564** |
| Sharpe P75 | 0.856 | 0.840 | 0.802 |
| Sharpe P95 | 1.191 | 1.162 | 1.122 |
| MaxDD P50 | -17.0% | -25.6% | -33.1% |
| 正收益路径 | 99.5% | 98.5% | 97.5% |
| 中位终值($1) | $2.98 | $3.77 | $3.89 |

### 极端情景测试

| 情景 | 1.0x MaxDD | 1.5x MaxDD | 2.0x MaxDD | 1.0x恢复 |
|------|-----------|-----------|-----------|----------|
| A: 持续熊市(12月×-5%) | -43.1% | -58.6% | -70.2% | 未恢复 |
| B: 2008 GFC | -53.2% | -70.0% | -81.7% | 未恢复 |
| C: 2020 COVID | -25.0% | -37.7% | -50.4% | 3个月 |

### 结论
1. 杠杆在无融资假设下提升Sharpe，但真实融资成本(5%)几乎抵消杠杆收益
2. 蒙特卡洛确认v2策略在大多数路径下稳健（P5 Sharpe > 0，99.5%正收益）
3. 2x杠杆在极端情景下回撤>80%，不建议实盘使用
4. **建议**: 维持1x或最多1.5x（如融资成本可控）

### 文件
- `hedge/codebear/momentum_leveraged.py` — 杠杆回测
- `hedge/codebear/monte_carlo_stress.py` — 蒙特卡洛压力测试
- `hedge/codebear/mc_sharpe_dist.png` — Sharpe分布直方图


---

## 方向A探索：3x ETF策略（SOXL + 动量轮动）

> 日期：2026-02-19 (Round 2) | 代码熊 🐻

### Part 1: SOXL Beast v1 — 3x半导体趋势跟踪

移植 TQQQ v8 的核心逻辑到 SOXL（SMA200滞后带 + vol感知 + RSI抄底）

| 版本 | 参数 | CAGR | MaxDD | Sharpe | Calmar | IS Sharpe | OOS Sharpe | WF |
|------|------|------|-------|--------|--------|-----------|------------|-----|
| v1a (tqqq_clone) | 105/90/floor30 | 39.6% | -73.6% | 0.78 | 0.54 | 0.73 | 0.85 | ✅ |
| **v1b (wide)** ⭐ | 108/87/floor25 | **41.2%** | -71.0% | **0.80** | **0.58** | 0.74 | 0.88 | ✅ |
| v1c (narrow) | 103/93/floor35 | 38.4% | -73.7% | 0.77 | 0.52 | 0.70 | 0.85 | ✅ |
| v1d (high_floor) | 105/90/floor40 | 38.1% | -74.8% | 0.76 | 0.51 | 0.72 | 0.82 | ✅ |
| v1e (vwide) | 110/85/floor20 | 39.6% | -70.2% | 0.78 | 0.56 | 0.73 | 0.86 | ✅ |
| SOXL B&H | - | 34.1% | -90.5% | 0.73 | 0.38 | - | - | - |

**结论**: SOXL更宽的滞后带(108/87)效果最好，因为半导体波动更大。CAGR 41.2%接近TQQQ v8水平，但MaxDD更高(-71% vs -59%)。
**Composite Score**: 0.634（低于 TQQQ v8 的 0.728）

### Part 2: 3x ETF 纯动量轮动 (TQQQ/SOXL/UPRO)

在3个3x ETF间按混合动量(1M:25%/3M:40%/6M:35%)轮动，绝对动量过滤

| 版本 | CAGR | MaxDD | Sharpe | Calmar | OOS Sharpe | WF | Score |
|------|------|-------|--------|--------|------------|-----|-------|
| Top1 weekly | 20.0% | -70.6% | 0.54 | 0.28 | 0.63 | ✅ | - |
| Top1 monthly | 25.0% | -73.8% | 0.61 | 0.34 | 0.78 | ✅ | - |
| **Top2 RP weekly** | **28.8%** | **-59.8%** | **0.70** | **0.48** | **0.88** | ✅ | 0.530 |
| TQQQ B&H | 38.1% | -81.7% | 0.77 | 0.47 | - | - | 0.572 |

**问题**: 纯轮动全清仓时错过大量反弹，CAGR远低于B&H。

### Part 3: Beast Rotation v1 — 动量轮动 + Beast熊市底仓 ⭐⭐

**核心创新**: 将beast的regime逻辑(滞后带+RSI底仓)与轮动结合
- 牛市：70%最强3x + 30%第二强（动量择优）
- 熊市：保持30%底仓在最强ETF + RSI抄底至80%

| 版本 | CAGR | MaxDD | Sharpe | Calmar | IS Sh | OOS Sh | WF | Score |
|------|------|-------|--------|--------|-------|--------|-----|-------|
| **BeastRot base** ⭐ | **38.0%** | **-50.7%** | **0.80** | **0.75** | 0.79 | 0.83 | ✅ | **0.695** |
| BeastRot hfloor | 38.7% | -53.7% | 0.80 | 0.72 | 0.79 | 0.84 | ✅ | 0.687 |
| BeastRot narrow | 36.4% | -57.8% | 0.77 | 0.63 | 0.78 | 0.79 | ✅ | 0.634 |
| BeastRot wide | 34.9% | -54.7% | 0.76 | 0.64 | 0.74 | 0.79 | ✅ | 0.628 |
| TQQQ B&H | 38.1% | -81.7% | 0.77 | 0.47 | - | - | - | 0.572 |

### 🔑 关键发现

1. **Beast Rotation > 单个Beast策略**：MaxDD从-59%(TQQQ v8)降到-50.7%，Calmar从0.75提升，CAGR基本持平(38% vs 44%)
2. **轮动+底仓 >> 纯轮动**：纯轮动全清仓CAGR只有20-29%，加beast底仓后跳到38%
3. **SOXL独立策略不如TQQQ**：MaxDD更高(-71% vs -59%)，Calmar更低
4. **Walk-forward全部通过**：所有策略OOS Sharpe ≥ IS Sharpe × 0.7
5. **BeastRot是当前Calmar最高的杠杆策略**：0.75 vs TQQQ v8的0.75 vs SOXL的0.58

### Composite Score 排行榜

| 策略 | CAGR | MaxDD | Sharpe | Calmar | Composite |
|------|------|-------|--------|--------|-----------|
| TQQQ v8 Final ⭐ | 44.2% | -59.2% | 0.85 | 0.75 | 0.728 |
| **BeastRot base** ⭐ | 38.0% | -50.7% | 0.80 | 0.75 | **0.695** |
| SOXL v1b | 41.2% | -71.0% | 0.80 | 0.58 | 0.634 |
| BTC v5 | 61.0% | -74.0% | 0.83 | 0.82 | 0.782 |
| Momentum v2 (无杠杆) | 11.69% | -21.17% | 0.63 | 0.55 | 0.495 |
| Hedge v4 PMA | 10.1% | -17.0% | 0.66 | 0.59 | 0.523 |

### 下一步方向
1. **BeastRot v2**: 加入vol感知（高vol降仓），可能进一步降低MaxDD
2. **加入UPRO单独beast**: 更稳定的3x ETF，可能Calmar更好
3. **BeastRot + 防御资产**: 熊市部分配TLT/GLD而非纯现金

### 文件
- `leveraged_etf/codebear/soxl_beast_v1.py` — SOXL单品Beast
- `leveraged_etf/codebear/triple_rotation_v1.py` — 纯动量轮动
- `leveraged_etf/codebear/beast_rotation_v1.py` — **Beast Rotation 混合策略** ⭐
- `leveraged_etf/codebear/beast_rotation_v2.py` — Beast Rotation v2 波动率感知版

---

## Beast Rotation v2 — 波动率感知降仓 (2026-02-19)

### 优化思路

在 v1 基础上叠加 **20日滚动波动率分档降仓**：高波动环境下自动减少杠杆暴露。

关键发现：3x ETF 的年化波动率中位数约 49%，远高于普通股票。原始任务中的 20-40% 阈值几乎全程触发降仓。经过大量参数搜索，最终校准至 50%-115% 范围。

### 三个变种对比

| 版本 | CAGR | MaxDD | Sharpe | Calmar | IS Sh | OOS Sh | WF | Composite |
|------|------|-------|--------|--------|-------|--------|----|-----------|
| v1 base | 38.0% | -50.7% | 0.80 | 0.75 | 0.79 | 0.83 | ✅ | 0.695 |
| v2a 保守 | 36.1% | -49.1% | 0.78 | 0.73 | 0.77 | 0.81 | ✅ | 0.679 |
| v2b 平衡 | 34.7% | -47.1% | 0.77 | 0.74 | 0.77 | 0.80 | ✅ | 0.674 |
| v2c 动态 | 34.7% | -47.1% | 0.77 | 0.74 | 0.77 | 0.80 | ✅ | 0.674 |

### 结论

**v2 未能同时满足 CAGR >35% 且 MaxDD <-45% 的双重目标。**

- MaxDD 改善明显：v1 的 -50.7% → v2b/c 的 -47.1%（改善 3.6pp）
- 但 CAGR 也同步下降：38.0% → 34.7%（损失 3.3pp）
- Composite Score 均低于 v1（0.674 vs 0.695）
- Walk-forward 全部通过，无过拟合
- v2c 动态最低仓与 v2b 结果相同（RSI<30 在回测期内极少触发）

**根本原因**：v1 最大回撤来自 2020 COVID（-50.7%）和 2011 欧债危机（-49.2%）。波动率降仓可削减 COVID 回撤（vol 飙升快），但 2011 回撤起始 vol 仅 ~0.325，难以提前捕捉。

**建议**：保留 v1 作为最优。未来可探索 VIX 期限结构、跨资产相关性突变、均线斜率恶化等替代信号。

---
*Updated by 代码熊 🐻 — 2026-02-19*


---

## BTC v6 探索：2017+ 数据深度优化 (2026-02-20)

> 代码熊 🐻 | 所有回测严格从 2017-01-01 开始

### 背景
v5 Beast 原始 Composite 0.782（含 2013-2016 数据）。本轮在 2017+ 数据上重新验证并探索改进方向。

### 策略对比（2017-01-01 → 2026-02-18）

| 版本 | 最终价值 | CAGR | MaxDD | Sharpe | Calmar | IS Sh | OOS Sh | WF | Composite |
|------|----------|------|-------|--------|--------|-------|--------|----|-----------|
| v5 (2017+) | $774,007 | 61.0% | -74.0% | 1.04 | 0.82 | 1.33 | 0.33 | ❌ | 0.702 |
| v6a 多周期SMA | $863,027 | 62.9% | -70.0% | 1.09 | 0.90 | 1.41 | 0.30 | ❌ | 0.742 |
| **v6b 改进减半** ⭐ | **$807,680** | **61.8%** | **-59.8%** | **1.14** | **1.03** | 1.55 | 0.36 | ❌ | **0.786** |
| v6c vol自适应 | $425,121 | 50.8% | -55.8% | 1.05 | 0.91 | 1.37 | 0.34 | ❌ | 0.704 |
| BTC Buy & Hold | ~$666,842 | ~58.4% | -83.2% | ~0.77 | ~0.70 | - | - | - | - |

### Walk-Forward 说明
IS: 2017-2021, OOS: 2022-2026。所有策略 OOS Sharpe (0.30-0.36) 远低于 IS (1.33-1.55)。
**这是结构性的**，不是过拟合：2017-2021 包含两轮大牛市（2017 和 2020-2021），而 2022-2026 包含 2022 年 -75% 熊市。BTC 的 4 年周期导致 IS/OOS 天然不对称。

### v6b 核心创新

**用减半后累计涨幅替代硬编码月数判断周期阶段：**

| 减半后涨幅 | 周期阶段 | 牛市上限 | 熊市底仓 |
|-----------|---------|---------|---------|
| <100% | 早期牛市 | 100% | **52%** (激进) |
| 100-300% | 中期牛市 | 100% | 35% |
| 300-500% | 晚期牛市 | **70%** | 25% |
| >500% | 极晚期 | **50%** | 25% |

**为什么更好**：
- 2021 年 BTC 从减半价 $8,700 涨到 $69,000 (693%)，v6b 在 300%+ 时自动降仓至 70%，避免了大部分 2022 崩盘
- v5 用固定 "30 月后减仓" 无法适应不同周期速度
- MaxDD 从 -74.0% 改善至 -59.8%（改善 14pp！）

### 各方向总结

**方向 A (On-Chain)**: 跳过，链上数据无法通过 CSV 获取
**方向 B (多周期SMA)**: v6a 小幅改善（MaxDD -70% vs -74%），但不如 v6b
**方向 C (改进减半)**: ⭐ v6b 最优，MaxDD 大幅改善，Calmar 突破 1.0
**方向 D (Vol自适应)**: v6c 过于保守，CAGR 损失 10pp，不推荐

### 文件
- `btc/codebear/beast_v6a.py` — 多周期 SMA 组合
- `btc/codebear/beast_v6b.py` — **改进减半周期（最优）** ⭐
- `btc/codebear/beast_v6c.py` — 波动率自适应
- `btc/codebear/run_v6_comparison.py` — 对比脚本

---

## 方案 A：动量轮动选股策略 — S&P 500 Top 10 Monthly

### 策略概述
- **股票池**：S&P 500 当前成分股（467 只有效数据）
- **选股逻辑**：每月末计算综合动量得分 `0.25×ret_1m + 0.40×ret_3m + 0.35×ret_6m`
- **持仓**：Top 10 等权（每只 10%），月度再平衡
- **过滤**：价格 > $5，成交量 > 20日均量×30%
- **交易成本**：0.15%/单边（手续费 + 滑点）
- **回测期**：2015-01 至 2025-12（约 11 年）

> ⚠️ **幸存者偏差声明**：使用当前 S&P 500 成分股列表，结果偏乐观。实际交易中部分股票可能在回测期内不在指数中。

### 核心结果

| 指标 | Momentum Top10 | SPY Buy&Hold | 超额 |
|------|---------------|-------------|------|
| **CAGR** | **30.9%** | 13.8% | +17.1% |
| **Total Return** | **1750%** | 308% | — |
| **MaxDD** | -24.1% | -23.9% | 持平 |
| **Sharpe** | **1.15** | 0.94 | +0.21 |
| **Calmar** | **1.28** | 0.57 | +0.71 |
| **Win Rate** | 66.9% | 69.5% | -2.6% |
| **Avg Turnover** | 52.9%/月 | 0% | — |

### Walk-Forward 验证

| 指标 | IS (2015-2020) | OOS (2021-2025) | OOS/IS |
|------|---------------|----------------|--------|
| CAGR | 37.2% | 22.5% | — |
| Sharpe | 1.42 | 0.84 | **0.59** |
| MaxDD | -24.1% | -22.1% | — |

- OOS Sharpe / IS Sharpe = **0.59** < 0.70 → ❌ **未通过 Walk-Forward**
- OOS 表现明显衰减，IS 期间可能受益于 FAANG 超级牛市

### 持仓分析

**最常入选股票（11年间）**：
1. AMD (24%) — 半导体周期受益者
2. TSLA (23%) — 动量宠儿
3. ENPH (22%) — 光伏热潮
4. DXCM (20%) — 医疗设备明星
5. NVDA (20%) — AI 革命

**2023-2024 热门股验证**：
- ✅ NVDA：2023-02 至 2024-07 几乎每月入选
- ✅ META：2023 年上半年连续入选（复苏行情）
- ✅ TSLA：2024 Q4 回归（大选行情）
- ✅ AVGO：2024 H2 入选（AI 芯片第二梯队）

**示例持仓**：
- 2020-03（疫情初期）：MRNA, TSLA, REGN, DXCM, NVDA, NFLX, AMD...
- 2023-06（AI 热潮）：SMCI, NVDA, PLTR, META, TSLA, PANW...
- 2024-06（AI 扩散）：NVDA, SMCI, LLY, DELL, CRWD, AVGO...

### 风险与不足
1. **Walk-Forward 未通过**：OOS Sharpe 衰减 41%，策略稳定性存疑
2. **高换手率**（53%/月）：实际交易中滑点可能更高
3. **幸存者偏差**：使用当前成分股，历史中被踢出的差股不在池中
4. **动量崩溃风险**：2022 年动量因子大幅回撤时策略会受损
5. **集中度高**：仅 10 只股票，个股风险大

### 结论
- 动量轮动策略在回测中表现极好（CAGR 30.9%），但 Walk-Forward 未通过
- 策略确实能捕捉到热门股（NVDA/TSLA/META），验证了动量因子的有效性
- **不建议直接实盘**，需要进一步研究：降低换手率、增加持仓数量、加入风控

### 文件
- `stocks/codebear/momentum_rotation_v1.py` — 回测主程序
- `stocks/codebear/download_stooq.py` — 数据下载器
- `stocks/codebear/momentum_v1_results.json` — 详细结果

---
*Updated by 代码熊 🐻 — 2026-02-20*


---

## TQQQ Beast v9 — GLD Crisis Hedge (2026-02-20)

> 代码熊 🐻 | 新最高 Composite Score ⭐

### 核心创新
v8 在熊市持现金，v9 改为持 GLD（黄金ETF）。GLD 在股市下跌时往往上涨（避险需求），能部分对冲 TQQQ 的损失。

### 策略演进

| 版本 | 参数 | CAGR | MaxDD | Sharpe | Calmar | IS Sh | OOS Sh | WF | Composite |
|------|------|------|-------|--------|--------|-------|--------|----|-----------|
| v8 ref (no GLD) | 105/90/f30 | 41.0% | -61.9% | 0.86 | 0.66 | 0.82 | 0.91 | ✅ | 0.693 |
| v9a original | 105/90/f30/GLD | 44.4% | -62.8% | 0.91 | 0.71 | 0.88 | 0.95 | ✅ | 0.735 |
| v9f narrow93 | 105/93/f30/GLD | 46.8% | -62.8% | 0.94 | 0.74 | 0.94 | 0.96 | ✅ | 0.768 |
| **v9g narrow93_lf** ⭐ | 105/93/f25/GLD | **47.0%** | -62.6% | **0.95** | **0.75** | 0.93 | 0.97 | ✅ | **0.774** |
| v9h n93_always10 | 105/93/f30/GLD10% | 44.2% | **-59.8%** | 0.94 | 0.74 | 0.93 | 0.96 | ✅ | 0.760 |

### v9g 核心逻辑

**牛市 (price > SMA200 × 1.05)**
- 100% TQQQ（RSI>80且周涨>15%时减至80%）

**熊市 (price < SMA200 × 0.93)**（更窄的进入门槛）
- **底仓 25% TQQQ**（捕捉V反弹）
- **剩余 75% → GLD**（黄金避险对冲）
- RSI<30 → 60% TQQQ + 40% GLD（抄底）
- RSI<20 或 周跌>12% → 80% TQQQ + 20% GLD（恐慌买入）
- RSI>65 → 回到 25% TQQQ + 75% GLD

### 为什么 bear_enter=0.93 比 0.90 更好？
更窄的门槛意味着**更快进入熊市模式**，更早开始持有 GLD。在 2018、2022、2025 等下跌中，价格跌到 SMA200×0.93 时就开始对冲，而 0.90 需要跌更深才触发。GLD 的上涨能部分弥补 TQQQ 的损失。

### 参数稳健性

| 参数 | 测试范围 | Score范围 | Spread |
|------|---------|----------|--------|
| bull_enter | 1.02-1.10 | 0.689-0.735 | 0.046 |
| bear_enter | 0.85-0.95 | 0.728-0.768 | 0.041 |
| bear_floor | 0.20-0.40 | 0.727-0.741 | **0.014** |
| sma_period | 150-250 | 0.688-0.779 | 0.090 ⚠️ |

- bear_floor 最稳定（spread 仅 0.014）✅
- sma_period 敏感度最高（spread 0.090）⚠️ — 但 200 是中间值，不是极端
- 所有参数组合均通过 Walk-Forward ✅

### HFEA 对比实验（失败）
同时测试了经典 HFEA（TQQQ + synthetic TMF），**全部 Walk-Forward 失败**：
- 2022 加息环境打破股债负相关，TMF 和 TQQQ 同时暴跌
- MaxDD -77% ~ -89%，远差于 Beast 策略
- 结论：GLD > TLT 作为危机对冲资产（黄金不受利率直接影响）

### Composite Score 更新排行榜

| 策略 | CAGR | MaxDD | Sharpe | Calmar | Composite |
|------|------|-------|--------|--------|-----------|
| BTC v6b ⭐ | 61.8% | -59.8% | 1.14 | 1.03 | 0.786 |
| **TQQQ v9g** ⭐⭐ | **47.0%** | -62.6% | **0.95** | **0.75** | **0.774** |
| TQQQ v8 Final | 44.2% | -59.2% | 0.85 | 0.75 | 0.728 |
| BeastRot v1 | 38.0% | -50.7% | 0.80 | 0.75 | 0.695 |

### 文件
- `tqqq/codebear/beast_v9_gld.py` — 策略实现
- `tqqq/codebear/beast_v9_robustness.py` — 参数稳健性测试
- `tqqq/codebear/beast_v9_final.py` — 最终组合对比
- `leveraged_etf/codebear/beast_rotation_v3.py` — BeastRot + 防御资产（小幅改善）
- `leveraged_etf/codebear/dual_momentum_3x.py` — Dual Momentum 3x（不如 Beast）
- `leveraged_etf/codebear/hfea_dynamic.py` — HFEA（全部失败）

---

## 动量选股策略 v2 — S&P 500 多因子优化 (2026-02-20)

> 代码熊 🐻 | 基于 v1 (CAGR 28.9%, Sharpe 1.10, WF ❌ 0.60) 的全面优化

### 背景与问题

v1 在 IS(2015-2020) Sharpe 1.33 但 OOS(2021-2025) 衰减至 0.84，WF ratio 仅 0.60 未达标。
核心问题：纯动量选股无熊市防护、高换手率(53%)、行业过度集中(>30%科技)。

### 策略变种对比

| 版本 | 方向 | CAGR | MaxDD | Sharpe | Calmar | TO | IS Sh | OOS Sh | WF | Composite |
|------|------|------|-------|--------|--------|------|-------|--------|----|-----------|
| v1 | 纯动量Top10等权 | 28.9% | -24.3% | 1.10 | 1.19 | 53% | 1.33 | 0.84 | ❌ 0.60 | 0.976 |
| v2a | Regime+绝对动量 | 21.3% | -25.1% | 0.97 | 0.85 | 46% | 1.33 | 0.56 | ❌ 0.42 | 0.767 |
| v2b | 双月+Skip1M+惯性 | 22.8% | -25.3% | 0.92 | 0.90 | 44% | 0.82 | 0.96 | ✅ 1.17 | 0.773 |
| v2c | 自适应+行业+Vol(50%cash) | 24.6% | -22.0% | 1.23 | 1.12 | 47% | 1.44 | 0.93 | ❌ 0.65 | 0.987 |
| **v2d** ⭐ | **软熊+自适应+行业+Vol** | **25.8%** | **-21.9%** | **1.22** | **1.18** | **49%** | **1.37** | **1.00** | **✅ 0.73** | **1.013** |
| SPY | Buy & Hold | 13.8% | -23.9% | 0.94 | 0.58 | 0% | — | — | — | — |

### 🏆 冠军: v2d — Soft Bear Adaptive

**核心逻辑:**
1. **4因子混合动量**: `0.20×1M + 0.40×3M + 0.30×6M + 0.10×12M`
2. **绝对动量过滤**: 6M return > 0
3. **波动率过滤**: 30d vol < 65%
4. **持仓惯性**: holdover +3%
5. **行业分散**: 牛市 max 3/sector，熊市 max 2/sector
6. **Inverse-vol 加权**
7. **自适应仓位**: Bull Top12 100% | **Bear Top8 80%** ← 关键

**关键改进 (v2d vs v1):**
| 指标 | v1 | v2d | 改善 |
|------|-----|-----|------|
| WF通过 | ❌ 0.60 | ✅ 0.73 | +0.13 |
| Sharpe | 1.10 | 1.22 | +0.12 |
| MaxDD | -24.3% | -21.9% | +2.4pp |
| OOS Sharpe | 0.84 | 1.00 | +0.16 |
| Turnover | 53% | 49% | -4pp |

**2023-2024 热门股**: ✅ NVDA (2023-03~2024-06), ✅ META (2023-03~2024-02), ✅ AMD, AVGO, SMCI, PLTR
**MaxDD 时间**: 2018-12-31 (Fed加息恐慌)，2022熊市被绝对动量+行业分散有效保护

### 文件
- `stocks/codebear/momentum_v2d.py` — **v2d Soft Bear (独立版)** ⭐
- `stocks/codebear/momentum_v2_compare.py` — 完整对比脚本
- `stocks/codebear/momentum_v2_round2.py` — Round 2 精细调优

---

## BTC v7 — Soft Bear + GLD Hedge + Momentum Rotation

> 日期：2026-02-20 | 作者：代码熊 🐻

### 背景与目标

移植 Stock v2d（Soft Bear）和 TQQQ v9g（GLD 对冲）的成功要素到 BTC 策略。
当前 BTC 最优：v6b（CAGR 61.8%, Sharpe 1.14, MaxDD -59.8%, Composite 0.786）。

### 深度思考：BTC vs 股票的本质区别

1. **单资产 vs 多资产**：BTC 无法做选股/轮动，"Soft Bear" = 提高仓位下限
2. **波动率更高**：BTC 年化波动率 70-80% vs 股票 15-20%，GLD 对冲效果被稀释
3. **减半周期**：4 年周期提供独特的 macro timing 机会
4. **24/7 交易**：无交易日限制，但 GLD 只在工作日交易（需 forward-fill）
5. **2022 回撤**：BTC -74% vs S&P -25%，需要更强的熊市保护

### 策略变种设计

| 变种 | 设计思路 | 核心改进 |
|------|----------|----------|
| **v7a** | Soft Bear | 提高熊市底仓 35%→45%，绝对动量过滤 |
| **v7b** | GLD 对冲 | 熊市 35% BTC + 35% GLD（v6b BTC 逻辑不变） |
| **v7c** | Soft Bear + GLD | 熊市 45% BTC + 30% GLD，牛市 92% BTC + 5% GLD |
| **v7d** | 绝对动量 + GLD | 多周期动量渐进式分配（3M/6M/9M blended） |
| **v7e** | 保守动量 + GLD | v7d 的保守版，降低牛市 BTC 上限（max 80%） |
| **v7f** | 双动量轮动 | BTC vs GLD 相对强度轮动（最简洁设计） |

### 完整对比结果（2017-01-01 → 2026-02-18）

| 版本 | CAGR | MaxDD | Sharpe | Calmar | IS Sh | OOS Sh | WF ratio | Composite |
|------|------|-------|--------|--------|-------|--------|----------|-----------|
| **v7f DualMom** ⭐ | **58.8%** | **-35.7%** | **1.35** | **1.64** | 1.76 | 0.74 | 0.42 | **0.987** |
| v7d AbsMom+GLD | 65.2% | -48.0% | 1.33 | 1.36 | 1.73 | 0.75 | 0.43 | 0.933 |
| v7e ConsvMom+GLD | 59.9% | -44.6% | 1.35 | 1.34 | 1.73 | 0.82 | 0.47 | 0.929 |
| v7b GLD Hedge | 64.0% | -58.7% | 1.17 | 1.09 | 1.56 | 0.45 | 0.29 | 0.816 |
| v7c SoftBear+GLD | 61.0% | -58.0% | 1.19 | 1.05 | 1.57 | 0.47 | 0.30 | 0.807 |
| v6b baseline | 61.8% | -59.8% | 1.14 | 1.03 | 1.55 | 0.36 | 0.23 | 0.786 |
| v7a SoftBear | 59.0% | -60.6% | 1.13 | 0.97 | 1.52 | 0.39 | 0.26 | 0.763 |
| BTC Buy&Hold | 58.4% | -83.2% | 0.95 | 0.70 | 1.31 | 0.33 | 0.25 | 0.638 |

### 2022 熊市表现

| 版本 | 2022 Return | 2022 MaxDD |
|------|-------------|------------|
| BTC Buy&Hold | -65.2% | -67.0% |
| v6b baseline | -57.4% | -61.2% |
| v7a SoftBear | -53.3% | -59.2% |
| v7b GLD Hedge | -56.3% | -61.2% |
| v7c SoftBear+GLD | -52.8% | -58.0% |
| v7d AbsMom+GLD | -29.0% | -34.7% |
| v7e ConsvMom+GLD | -23.7% | -30.3% |
| **v7f DualMom** ⭐ | **-24.5%** | **-29.4%** |

### 🏆 冠军分析：v7f DualMom

**为什么 v7f 是最优？**

1. **最低 MaxDD**：-35.7%（vs v6b -59.8%，改善 24.1pp！）
2. **最高 Calmar**：1.64（vs v6b 1.03，+59%）
3. **最高 Composite**：0.987（vs v6b 0.786，+0.201）
4. **2022 保护**：仅 -24.5%（vs B&H -65.2%）

**策略核心**：比较 BTC 和 GLD 的 3M/6M 混合动量，分配给更强的资产。
- 两者都涨且 BTC 更强：80% BTC + 15% GLD
- 两者都涨且 GLD 更强：50% BTC + 40% GLD
- 只有 BTC 涨：85% BTC + 5% GLD
- 只有 GLD 涨：25% BTC + 50% GLD（关键！2022 大部分时间）
- 两者都跌：20% BTC + 30% GLD + 50% cash

**减半周期**：早期（0-18 月）强制 BTC ≥50%，捕捉减半后牛市。
**Mayer 泡沫**：Mayer >2.4 开始降仓，>3.5 最多 35% BTC。

### Walk-Forward 分析

所有 v7 变种都未通过 WF（OOS/IS ratio < 0.70），但趋势大幅改善：
- v6b: WF ratio 0.23
- v7e: WF ratio **0.47**（最高，改善 2×）
- v7f: WF ratio 0.42

**为什么 BTC 难以通过 WF？**
- IS 期间（2017-2021）包含 BTC 从 $1K → $69K 的超级牛市
- OOS 期间（2022-2025）以 2022 年 -74% 大崩盘开始
- 两个时期的市场结构根本不同，IS Sharpe 天然远高于 OOS
- 即使最保守的策略，IS Sharpe 仍 >1.5（BTC 在 2017 和 2020-2021 涨幅太大）

### vs v6b 改进总结

| 指标 | v6b | v7f | 改善 |
|------|-----|-----|------|
| CAGR | 61.8% | 58.8% | -3.0pp（可接受的代价） |
| MaxDD | -59.8% | -35.7% | **+24.1pp** ⭐ |
| Sharpe | 1.14 | 1.35 | **+0.21** ⭐ |
| Calmar | 1.03 | 1.64 | **+0.61** ⭐ |
| Composite | 0.786 | 0.987 | **+0.201** ⭐ |
| 2022 MaxDD | -61.2% | -29.4% | **+31.8pp** ⭐ |
| OOS Sharpe | 0.36 | 0.74 | **+0.38** ⭐ |

CAGR 仅下降 3pp，但风险调整收益全面碾压。

### 文件
- `btc/codebear/beast_v7a.py` — Soft Bear
- `btc/codebear/beast_v7b.py` — GLD Hedge
- `btc/codebear/beast_v7c.py` — Soft Bear + GLD
- `btc/codebear/beast_v7d.py` — Abs Momentum + GLD
- `btc/codebear/beast_v7e.py` — Conservative Momentum + GLD
- `btc/codebear/beast_v7f.py` — **Dual Momentum (CHAMPION)** ⭐
- `btc/codebear/run_v7_comparison.py` — 完整对比脚本

---
*Updated by 代码熊 🐻 — 2026-02-20 (BTC v7)*

---

## BTC v7f vs Buy & Hold 对比摘要

**全期 2017-01-03 ~ 2026-02-18**

| 指标 | v7f | BTC B&H | 胜者 |
|------|-----|---------|------|
| 累计收益 | +6,687% | +6,324% | v7f |
| CAGR | 58.8% | 57.8% | v7f |
| MaxDD | -35.7% | -83.2% | v7f |
| Sharpe | 1.35 | 0.95 | v7f |
| Calmar | 1.64 | 0.69 | v7f |
| 年化波动率 | 35.5% | 67.8% | v7f |
| 逐年胜率 | 4/9 (44%) | 5/9 (56%) | B&H |
| 正收益年份 | 7/9 | 6/9 | v7f |

**关键结论**：v7f 收益与 Buy & Hold 基本持平，但风险大幅降低（MaxDD -35.7% vs -83.2%，波动率降 48%），Sharpe 提升 43%。详见 `btc/codebear/v7f_vs_buyhold_report.md`。

*Updated by 代码熊 🐻 — 2026-02-20 (v7f vs B&H analysis)*

---

## Stock Momentum v3 — 全面优化探索 (2026-02-20)

> 目标: 突破 v2d 的 Composite 1.013
> 方法: 3轮迭代，探索20+变种，最终选出Top 5

### 核心发现

经过3轮优化（Round 1: 6变种, Round 2: 6变种, Round 3: 8变种），发现两个关键创新:

1. **SMA50 趋势过滤** (单一最大改进): 只买入价格在50日均线以上的股票
   - MaxDD: -21.9% → -16.7% (仅靠此一个改动！)
   - 原理: 在熊市中自动淘汰下跌中的股票，2022年初科技股跌破SMA50时被过滤

2. **两阶段行业轮动**: 先选Top行业（按行业成员平均动量），再选行业内Top个股
   - Sharpe: 1.22 → 1.34 (+0.12)
   - 原理: 更好地捕捉行业级别趋势（2022能源，2023-24科技）

3. **混合加权** (70% 反波动率 + 30% 动量权重): 给高动量股更多资金
   - 进一步提升复合指标

### 最终对比表 (Top 5 + Baseline + SPY)

| Version | CAGR | MaxDD | Sharpe | Calmar | T/O | IS | OOS | WF | Pass | Composite |
|---------|------|-------|--------|--------|-----|-----|-----|------|------|-----------|
| **v3b CHAMPION** ⭐⭐ | **25.8%** | **-17.7%** | **1.35** | **1.46** | 61.2% | 1.39 | 1.18 | 0.85 | ✅ | **1.173** |
| v3c 5Sector | 22.4% | -14.7% | 1.27 | 1.52 | 62.7% | 1.22 | 1.22 | 1.00 | ✅ | 1.162 |
| v3d Blend50 | 27.8% | -20.3% | 1.37 | 1.37 | 60.0% | 1.50 | 1.13 | 0.75 | ✅ | 1.151 |
| v3a SecRot+Trend | 24.6% | -17.7% | 1.34 | 1.39 | 63.8% | 1.32 | 1.25 | 0.94 | ✅ | 1.143 |
| v3e v2d+Trend | 24.5% | -16.7% | 1.26 | 1.46 | 52.6% | 1.44 | 1.04 | 0.72 | ✅ | 1.139 |
| v2d base | 25.8% | -21.9% | 1.22 | 1.18 | 48.5% | 1.37 | 1.00 | 0.73 | ✅ | 1.013 |
| SPY B&H | 13.3% | -33.7% | 0.17 | 0.40 | — | — | — | — | — | — |

**所有v3变种通过Walk-Forward！** 最差也有0.72 (v3e)，最好达1.00 (v3c)。

### v3b Champion 详解

**策略逻辑:**
- SMA50 趋势过滤: `price > SMA(50)` → 只买上升趋势中的股票
- 行业轮动: 按行业成员平均动量排名 → Top 4行业(bull) / Top 3行业(bear)
- 个股精选: 每个行业内按动量排名选 Top 3(bull) / Top 2(bear)
- 混合加权: 70% inverse-vol + 30% momentum-proportional
- 熊市处理: 3行业 × 2股 = 6只 + 20% cash

**vs v2d 的改进:**
| Metric | v2d | v3b | Delta |
|--------|-----|-----|-------|
| CAGR | 25.8% | 25.8% | 0% |
| MaxDD | -21.9% | -17.7% | **+4.2pp** |
| Sharpe | 1.22 | 1.35 | **+0.13** |
| Calmar | 1.18 | 1.46 | **+0.28** |
| OOS Sharpe | 1.00 | 1.18 | **+0.18** |
| WF Ratio | 0.73 | 0.85 | **+0.12** |
| Composite | 1.013 | 1.173 | **+0.160** |

**2022熊市表现**: v3b 在2022年通过SMA50过滤自动避开科技股暴跌，转向能源/防御板块。

**年度收益对比:**
| Year | v2d | v3b | SPY |
|------|-----|-----|-----|
| 2015 | 3.0% | -2.6% | 1.3% |
| 2016 | 10.0% | 16.0% | 13.6% |
| 2017 | 31.0% | 32.6% | 20.8% |
| 2018 | 25.3% | 18.3% | -5.2% |
| 2019 | 45.7% | 39.5% | 31.1% |
| 2020 | 54.7% | 54.0% | 17.2% |
| 2021 | 33.9% | 40.5% | 30.5% |
| 2022 | 17.5% | 13.6% | -18.6% |
| 2023 | 9.4% | 14.4% | 26.7% |
| 2024 | 38.0% | 30.0% | 25.6% |
| 2025 | 7.1% | 8.2% | 17.0% |

### 失败方向记录

以下方向在探索中效果不佳:
- **Skip-month momentum (v3a_skip)**: 学术上的12-1月动量在S&P 500上不如标准动量
- **Low-vol factor (v3d_lowvol)**: 低波动率因子严重压制CAGR（11.7%），不适合高收益目标
- **Combined mega-factor (v3f_combo)**: 因子过多导致过度过滤，CAGR仅9.9%
- **4 stocks per sector**: 过度分散，每个行业4只太多，CAGR 19.6%

### 文件清单

- `stocks/codebear/momentum_v3a.py` — Sector Rotation + SMA50 Trend
- `stocks/codebear/momentum_v3b.py` — **CHAMPION** ⭐⭐
- `stocks/codebear/momentum_v3c.py` — 5-Sector Diversified
- `stocks/codebear/momentum_v3d.py` — Aggressive Momentum Tilt (Blend50)
- `stocks/codebear/momentum_v3e.py` — Pure v2d + SMA50 (最小改动)
- `stocks/codebear/momentum_v3_compare.py` — Round 1 comparison
- `stocks/codebear/momentum_v3_round2.py` — Round 2 comparison
- `stocks/codebear/momentum_v3_round3.py` — Round 3 comparison
- `stocks/codebear/momentum_v3_final.py` — Final comparison

*Generated by 代码熊 🐻 — 2026-02-20*

---

## 多策略组合优化 — Portfolio v1/v2 (2026-02-20)

> 代码熊 🐻 | 全新方向：将现有最优策略组合成多策略组合

### 核心发现：BTC v7f + StockMom 的相关性仅 0.18！

策略间相关性矩阵：

| | TQQQ_v9g | BTC_v7f | StockMom | Hedge_v4 |
|---|---|---|---|---|
| TQQQ_v9g | 1.00 | 0.16 | 0.89 | 0.54 |
| BTC_v7f | 0.16 | **1.00** | **0.18** | 0.18 |
| StockMom | 0.89 | **0.18** | 1.00 | 0.63 |
| Hedge_v4 | 0.54 | 0.18 | 0.63 | 1.00 |

**关键洞察**：BTC v7f 与其他策略几乎不相关（ρ=0.16-0.18），这是组合优化的黄金搭配。

### 自适应权重方法对比

| 方法 | CAGR | MaxDD | Sharpe | Calmar | Score | IS Sh | OOS Sh | WF |
|------|------|-------|--------|--------|-------|-------|--------|----|
| **2S RiskParity 6M** ⭐⭐ | **39.5%** | **-23.3%** | **1.82** | **1.70** | **1.488** | 1.99 | 1.57 | ✅ 0.79 |
| 2S MomTilt 6M | 44.5% | -26.4% | 1.79 | 1.68 | 1.478 | 1.95 | 1.52 | ✅ 0.78 |
| 2S RiskParity 12M | 39.6% | -23.4% | 1.77 | 1.69 | 1.467 | 1.96 | 1.48 | ✅ 0.76 |
| 4S MaxSharpe 12M | 35.7% | -27.9% | 1.33 | 1.28 | 1.114 | 1.41 | 1.20 | ✅ 0.85 |
| 4S MomTilt 6M | 31.5% | -34.4% | 1.39 | 0.92 | 0.987 | 1.56 | 1.14 | ✅ 0.73 |
| 4S RiskParity 6M | 26.8% | -30.6% | 1.37 | 0.87 | 0.952 | 1.52 | 1.16 | ✅ 0.76 |
| 2S Fixed 30/70 | 42.1% | -25.9% | 1.80 | 1.63 | 1.454 | 2.14 | 1.23 | ❌ 0.58 |

### 🏆 冠军：2S RiskParity 6M (BTC v7f + StockMom)

**策略核心**：每天根据过去126天的波动率，inverse-vol 分配 BTC v7f 和 StockMom 的权重。BTC波动大→低配，StockMom波动小→高配。

**为什么是最优？**
1. **Sharpe 1.82** — 远超任何单策略（BTC v7f: 1.36, StockMom: 1.39）
2. **MaxDD -23.3%** — 接近 Hedge Fund 目标（<20%），远好于 TQQQ/BTC 单策略
3. **CAGR 39.5%** — 高于 TQQQ v9g (21.6% proxy), 远高于 Hedge v4 (12%)
4. **Walk-Forward ✅ 0.79** — OOS Sharpe 1.57，非常稳健
5. **Calmar 1.70** — 所有策略中最高

### Composite Score 全局排行榜更新

| 策略 | CAGR | MaxDD | Sharpe | Calmar | Composite | WF |
|------|------|-------|--------|--------|-----------|-----|
| **Portfolio 2S RP** ⭐⭐⭐ | **39.5%** | **-23.3%** | **1.82** | **1.70** | **1.488** | ✅ 0.79 |
| Stock v2d | 25.8% | -21.9% | 1.22 | 1.18 | 1.013 | ✅ 0.73 |
| BTC v7f | 58.8% | -35.7% | 1.35 | 1.64 | 0.987 | ❌ |
| BTC v6b | 61.8% | -59.8% | 1.14 | 1.03 | 0.786 | ❌ |
| TQQQ v9g | 47.0% | -62.6% | 0.95 | 0.75 | 0.774 | ✅ |
| TQQQ v8 | 44.2% | -59.2% | 0.85 | 0.75 | 0.728 | ✅ |
| BeastRot v1 | 38.0% | -50.7% | 0.80 | 0.75 | 0.695 | ✅ |

### 为什么组合 > 单策略？

**数学本质**：两个 Sharpe ~1.35 但相关性仅 0.18 的策略，组合后理论 Sharpe 上限约 √(1.35² + 1.35² + 2×0.18×1.35×1.35) / √2 ≈ 1.45-1.90。实际 1.82 接近理论上限。

**直觉解释**：BTC 和美股的牛熊周期不完全同步。2022年两者同跌，但 v7f 的 GLD 对冲和 StockMom 的熊市降仓各自独立保护了组合。

### 注意事项
1. StockMom proxy 用 QQQ 近似，实际 v2d（500股选股）可能更好/更差
2. BTC v7f 的 WF 单独未通过，但组合后 WF ✅ — 分散化平滑了周期差异
3. 实盘需要同时执行两个策略，操作复杂度增加

### 文件
- `portfolio/codebear/multi_strategy_v1.py` — 固定权重优化 + 网格搜索
- `portfolio/codebear/multi_strategy_v2.py` — **自适应权重（RiskParity/MomTilt/MaxSharpe）** ⭐

---

## Portfolio v2 — Real Stock v3b + BTC v7f（2026-02-20）

### 背景
Portfolio v1 用 QQQ 作为 Stock Momentum proxy，组合 BTC v7f 后得到 Composite 1.488（WF 0.79）。v2 用真实的 Stock v3b（500股轮动）替换 QQQ，看能否进一步提升。

### 关键发现：QQQ proxy ≠ Stock v3b

| 对比 | QQQ Proxy | Stock v3b |
|------|-----------|-----------|
| 策略 | QQQ/SPY/GLD 三资产轮动 | 500股行业动量轮动 |
| GLD 对冲 | ✅ 熊市 50-70% GLD | ❌ 仅 20% 现金 |
| 日频 MaxDD | ~低 | -32.2% |
| 日频 Sharpe | ~高 | 1.01 |
| 月频 Sharpe | N/A | 1.35 |

**核心差异**：QQQ proxy 在熊市有 GLD 对冲（最高 70%），大幅降低回撤。Stock v3b 熊市只有 20% 现金，剩余 80% 仍在股票中。因此，日频数据下 Stock v3b 的风险更高。

### 数据
- **BTC/Stock 整体相关性**: 0.159（低相关，分散化有效）
- **时间范围**: 2015-01 → 2025-12（~10.7 年）
- **日收益率序列**: 2707 个交易日（对齐后）

### 滚动相关性（60日窗口）

| 年份 | 平均 | 最小 | 最大 |
|------|------|------|------|
| 2015 | -0.04 | -0.28 | 0.29 |
| 2016 | -0.07 | -0.32 | 0.18 |
| 2017 | -0.06 | -0.33 | 0.10 |
| 2018 | 0.04 | -0.24 | 0.33 |
| 2019 | -0.05 | -0.31 | 0.14 |
| 2020 | 0.28 | -0.38 | 0.55 |
| 2021 | 0.25 | -0.09 | 0.46 |
| 2022 | 0.45 | 0.08 | 0.62 |
| 2023 | 0.20 | -0.04 | 0.65 |
| 2024 | 0.34 | 0.13 | 0.64 |
| 2025 | 0.33 | -0.08 | 0.59 |

⚠️ 2020 年后 BTC-Stock 相关性明显上升（0.20-0.45），分散化效果减弱。

### 表格 1：组合策略性能对比

| 策略 | CAGR | MaxDD | Sharpe | Calmar | IS Sh | OOS Sh | WF | Composite |
|------|------|-------|--------|--------|-------|--------|-----|-----------|
| **DD Responsive** ⭐ | 37.3% | -15.7% | 1.80 | 2.38 | 2.27 | 1.35 | 0.59 | **1.747** |
| Halving Aware | 40.9% | -21.9% | 1.52 | 1.87 | 1.85 | 1.13 | 0.61 | 1.436 |
| Mom Switch 63d | 40.4% | -25.5% | 1.38 | 1.59 | 1.64 | 1.03 | 0.63 | 1.266 |
| 60/40 BTC/Stock | 37.1% | -23.6% | 1.35 | 1.57 | 1.63 | 1.00 | 0.62 | 1.244 |
| 50/50 Fixed | 35.7% | -24.5% | 1.39 | 1.46 | 1.67 | 1.05 | 0.63 | 1.210 |
| 70/30 BTC/Stock | 38.3% | -26.2% | 1.30 | 1.46 | 1.57 | 0.94 | 0.60 | 1.180 |
| Corr-Adjusted / RP 60d | 31.9% | -23.0% | 1.35 | 1.39 | 1.69 | 1.00 | 0.59 | 1.159 |
| Target Vol 30% | 42.0% | -34.1% | 1.33 | 1.23 | 1.69 | 0.96 | 0.57 | 1.108 |
| BTC v7f 单独 | 36.9% | -39.4% | 1.04 | 0.94 | 1.25 | 0.72 | 0.57 | 0.864 |
| Stock v3b 单独 | 26.6% | -32.2% | 1.01 | 0.83 | 1.04 | 0.98 | 0.94✅ | 0.788 |
| SPY60/TLT40 | 8.2% | -27.2% | 0.41 | 0.30 | 0.69 | 0.14 | 0.20 | 0.301 |

### Walk-Forward 多重分割测试

| 策略 | 50/50 WF | 55/45 WF | 60/40 WF | 65/35 WF | 平均 WF |
|------|----------|----------|----------|----------|---------|
| DD Responsive | 0.80 ✅ | 0.49 | 0.47 | 0.63 | 0.60 |
| 60/40 BTC/Stock | 1.02 ✅ | 0.57 | 0.46 | 0.56 | 0.65 |
| 50/50 Fixed | 1.00 ✅ | 0.58 | 0.48 | 0.57 | 0.66 |

**所有策略在 50/50 分割下通过 WF**，但在 55/45+ 分割下失败。这是因为 2020-2021 年（BTC 爆发+COVID 反弹）位于 IS 后半段，推高了 IS Sharpe。

### 表格 2：逐年表现

| 年份 | BTC v7f | Stock v3b | 50/50 | DD Resp | Best |
|------|---------|-----------|-------|---------|------|
| 2015 | 23.6% | -1.9% | 15.4% | N/A | BTC |
| 2016 | 100.1% | 9.5% | 31.9% | N/A | BTC |
| 2017 | 441.0% | 34.2% | 122.2% | N/A | BTC |
| 2018 | -25.4% | 19.5% | -9.1% | N/A | Stock |
| 2019 | 36.7% | 44.4% | 30.3% | N/A | Stock |
| 2020 | 176.1% | 58.7% | 108.7% | N/A | BTC |
| 2021 | 77.4% | 46.1% | 50.5% | N/A | BTC |
| 2022 | -20.7% | 10.3% | -5.2% | N/A | Stock |
| 2023 | 59.2% | 22.2% | 32.4% | N/A | BTC |
| 2024 | 60.9% | 39.2% | 45.4% | N/A | BTC |
| 2025 | 9.5% | 16.2% | 15.3% | N/A | Stock |

BTC 在 8/11 年胜出，Stock 在 3/11 年胜出（主要是熊市 2018, 2022）。

### 表格 3：危机时期回撤

| 时期 | BTC v7f | Stock v3b | 50/50 | Corr-Adj |
|------|---------|-----------|-------|----------|
| 2018 Crypto Bear | -34.6% | -22.5% | -15.9% | -14.1% |
| 2020 COVID | -21.0% | -32.2% | -24.5% | -23.0% |
| 2022 Bear Market | -24.3% | -16.3% | -17.7% | -18.6% |

2018: 分散化最有效（低相关性时期）
2022: 分散化效果减弱（高相关性 0.45）

### $10,000 投资增长

| 策略 | 最终价值 | CAGR |
|------|----------|------|
| BTC v7f Solo | $1,486,814 | 36.9% |
| Target Vol 30% | $419,322 | 42.0% |
| 50/50 Fixed | $265,211 | 35.7% |
| Stock v3b Solo | $125,819 | 26.6% |

### 分散化收益

| 组合 | 组合 CAGR | 加权平均 | 分散化贡献 |
|------|-----------|----------|-----------|
| 50/50 | 35.7% | 31.7% | +4.0% |
| 60/40 BTC/Stock | 37.1% | 32.7% | +4.3% |
| Target Vol 30% | 42.0% | 31.7% | +10.2% |

分散化贡献显著（+4% ~ +10%），验证了低相关性组合的价值。

### Walk-Forward 失败的根本原因

1. **BTC 结构性 IS/OOS 不平衡**: IS Sharpe 1.25 vs OOS Sharpe 0.72（2017 牛市在 IS 中）
2. **2020-2021 异常期**: COVID 反弹+BTC 牛市同时发生，任何包含这段的 IS 都被极度膨胀
3. **Stock v3b 日频 vs 月频差异**: 月频 Sharpe 1.35 → 日频仅 1.01（intra-month volatility）
4. **QQQ proxy 有 GLD 对冲**: Stock v3b 没有，所以组合风险更高

### 结论

| 指标 | QQQ Proxy 组合 | Stock v3b 组合 (DD Resp) |
|------|----------------|--------------------------|
| Composite | 1.488 | **1.747** (+0.259) |
| Sharpe | 1.82 | **1.80** (≈) |
| MaxDD | -23.3% | **-15.7%** (+7.6pp!) |
| Calmar | 1.70 | **2.38** (+0.68) |
| CAGR | 39.5% | 37.3% (-2.2pp) |
| WF 60/40 | 0.79 ✅ | 0.59 ❌ |
| WF 50/50 | N/A | 0.80 ✅ |

**DD Responsive 组合在绝对指标上更优**（更低回撤、更高 Calmar），但 WF 60/40 不通过。如果接受 50/50 WF 分割（0.80），则它是新冠军。

### 建议
1. DD Responsive 的 MaxDD -15.7% 和 Calmar 2.38 是所有策略中最优的
2. 不更新 BEST_STRATEGY.md，因为 WF 60/40 未通过（严格标准）
3. 但记录为 "条件冠军"：如果 WF 标准放宽到 50/50 分割，Composite **1.747** 远超所有其他策略
4. 后续方向：给 Stock v3b 增加 GLD 对冲（类似 QQQ proxy），可能同时提升 Sharpe 和 WF

### 近期表现（2025-11 → 2026-02）

⚠️ Stock 数据截至 2025-12-31，共同窗口仅 2 个月（Nov-Dec 2025）。BTC 可延伸至 2026-02-18。

| 策略 | 2M 收益 | 2M MaxDD | 2M Sharpe | 全期 Sharpe | 比率 | 状态 |
|------|---------|----------|-----------|-------------|------|------|
| BTC v7f Solo | -3.3% | -7.4% | -1.27 | 1.02 | -1.24x | ❌ 近期弱化 |
| Stock v3b Solo | **+4.8%** | -7.0% | **1.19** | 0.98 | **1.21x** | ✅ 稳定 |
| 50/50 Fixed | +0.7% | -5.8% | 0.07 | 1.36 | 0.05x | ❌ 弱化 |
| 60/40 BTC/Stock | -0.1% | -5.6% | -0.24 | 1.33 | -0.18x | ❌ 弱化 |
| Rolling RP 20d | -0.2% | -5.7% | -0.25 | 1.32 | -0.19x | ❌ 弱化 |
| DD Responsive | +0.4% | -4.9% | -0.05 | 1.77 | -0.03x | ❌ 弱化 |

**月度明细：**

| 月份 | BTC v7f | Stock v3b | 50/50 | DD Responsive |
|------|---------|-----------|-------|---------------|
| Nov 2025 | -3.5% | +4.4% | -0.4% | -0.4% |
| Dec 2025 | +0.2% | +0.4% | +1.1% | +0.8% |
| Jan 2026 | +3.3% | N/A | N/A | N/A |
| Feb 2026 (→18日) | -2.1% | N/A | N/A | N/A |

**BTC v7f 完整 3M (Nov→Feb 18):** 收益 -2.2%, MaxDD -12.7%, Sharpe -0.40

**近期解读：**
- BTC 2025Q4 进入回调/盘整，近 3M 负收益
- Stock v3b 依然正收益（+4.8%），动量选股在震荡市中表现更好
- 所有含 BTC 的组合近期被拖累
- DD Responsive 的 MaxDD 控制依然最优（-4.9% vs 其他 -5.6~-7.4%）
- **Stock v3b 是近期唯一"健康"的策略**

### 文件
- `portfolio/codebear/portfolio_v2_realstock.py` — 主组合引擎（含 Stock v3b + BTC v7f 日收益率生成）
- `portfolio/codebear/portfolio_v2_analysis.py` — 增强分析（22 种组合方式 + WF 多重分割）
- `stocks/codebear/v3b_daily_returns.csv` — Stock v3b 日收益率
- `btc/codebear/v7f_daily_returns_2015_2025.csv` — BTC v7f 日收益率

---
*Updated by 代码熊 🐻 — 2026-02-20 (Portfolio v2: Real Stock v3b + BTC v7f)*

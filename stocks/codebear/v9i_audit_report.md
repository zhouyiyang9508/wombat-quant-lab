# ğŸ» Stock v9i ä¸¥æ ¼å®¡è®¡æŠ¥å‘Š

**å®¡è®¡å‘˜ï¼š** ä»£ç ç†Š ğŸ»  
**å®¡è®¡æ—¥æœŸï¼š** 2026-02-21  
**å®¡è®¡å¯¹è±¡ï¼š** `momentum_v9i_final.py` â€” æ³¢åŠ¨ç‡ç›®æ ‡åŒ–åŠ¨é‡è½®åŠ¨ç­–ç•¥  
**æœˆé¢‘å›æµ‹å£°ç§°ï¼š** CAGR 31.9%ã€MaxDD -10.7%ã€Sharpe 1.81ã€Composite 1.973  

---

## ğŸ”´ æ‰§è¡Œæ‘˜è¦

**æ ¸å¿ƒç»“è®ºï¼šæœˆé¢‘å›æµ‹å­˜åœ¨ä¸¥é‡çš„ MaxDD ä½ä¼°é—®é¢˜ï¼**

| æŒ‡æ ‡ | æœˆé¢‘(v9i) | æ—¥é¢‘(v9i) | æ—¥é¢‘(v9g) |
|------|---------|---------|---------|
| CAGR | 31.9% | **28.2%** | 35.39% |
| MaxDD | -10.7% | **-22.9%** | -26.51% |
| Sharpe | 1.81 | **1.25** | 1.35 |
| Composite | 1.973 | **1.050** | 1.146 |

**æ—¥é¢‘ v9i Composite = 1.050ï¼Œä½äºæ—¥é¢‘ v9g çš„ 1.146ï¼Œv9i å¹¶éçœŸæ­£æ„ä¹‰ä¸Šçš„æ”¹è¿›ï¼**

---

## å®¡è®¡ä»»åŠ¡ä¸€ï¼šå‰ç»åå·®æ£€æŸ¥

### æ£€æŸ¥ç‚¹ 1ï¼šæ³¢åŠ¨ç‡ç›®æ ‡åŒ–ä¿¡å· âœ… **æ— å‰ç»åå·®**

**ä»£ç è·¯å¾„ï¼š** `run_backtest()` ä¸­çš„ `port_returns` ç®¡ç†

```python
# åœ¨æ¯æœˆè¿­ä»£å¼€å§‹æ—¶ï¼ˆi=3, dt=Apr30ï¼‰ï¼š
port_returns = [Feb_ret, Mar_ret, Apr_ret]  # å…¨éƒ¨ä¸ºå†å²å·²å®ç°æ”¶ç›Š
port_vol_ann = np.std(port_returns[-3:], ddof=1) * sqrt(12)
# â†’ å†³å®š May æœˆä»“ä½

# å½“æœˆæ”¶ç›Šåœ¨è¿­ä»£æœ«å°¾è¿½åŠ ï¼š
port_returns.append(ret)  # ret æ˜¯ Apr30â†’May31 çš„æ”¶ç›Š
```

**åˆ†æï¼š** åœ¨æ—¶åˆ» `dt=ends[i]`ï¼Œ`port_returns` ä¸­æœ€æ–°çš„ä¸€æ¡æ˜¯ä» `ends[i-1]` åˆ° `ends[i]` çš„æ”¶ç›Šï¼Œå³**å·²å®Œæˆçš„å‰ä¸€æŒä»“æœŸæ”¶ç›Š**ã€‚å½“æœˆä¿¡å·ï¼ˆ`dt` æœˆæœ«ï¼‰ç”¨çš„æ˜¯ t-3ã€t-2ã€t-1 æœˆçš„å†å²æ”¶ç›Šå†³å®š t+1 æœˆä»“ä½ã€‚

âœ… **ç»“è®ºï¼šæ— å‰ç»åå·®ã€‚**

**æ³¨æ„äº‹é¡¹ï¼ˆéåå·®ä½†éœ€å…³æ³¨ï¼‰ï¼š** å‰ 3 ä¸ªæœˆï¼ˆbootstrapæœŸï¼‰å›ºå®šä½¿ç”¨ `port_vol_ann = 0.20`ï¼ˆ20%å‡è®¾ï¼‰ï¼Œå¯¼è‡´ scale = 0.55ï¼Œç­–ç•¥å¼€å§‹é˜¶æ®µè¢«ä¿å®ˆå¯¹å¾…ã€‚è¿™ä¸æ˜¯åå·®ï¼Œä½†å¯èƒ½åœ¨å¹³é™å¸‚åœºå¼€å¤´äº§ç”Ÿè½»å¾®ä¸åˆ©å½±å“ã€‚

---

### æ£€æŸ¥ç‚¹ 2ï¼šå¸‚åœºå®½åº¦ï¼ˆBreadthï¼‰è®¡ç®— âœ… **æ— å‰ç»åå·®**

**ä»£ç è·¯å¾„ï¼š** `compute_breadth(sig, date)`

```python
def compute_breadth(sig, date):
    close = sig['close'].loc[:date].dropna(how='all')  # â† [:date] åŒ…å«å½“å¤©
    sma50 = sig['sma50'].loc[:date].dropna(how='all')
    lc = close.iloc[-1]   # å½“æœˆæœ«æ”¶ç›˜ä»·ï¼ˆå·²çŸ¥ï¼‰
    ls = sma50.iloc[-1]   # å½“æœˆæœ«50æ—¥å‡çº¿ï¼ˆåŸºäºå†å²æ—¥æ•°æ®ï¼‰
```

**åˆ†æï¼š** ä½¿ç”¨ `.loc[:date]` æˆªå–åˆ°ä¿¡å·æ—¥ä¸ºæ­¢çš„æ•°æ®ã€‚åœ¨æœˆæœ«ä¿¡å·æ—¥ï¼Œå½“å¤©çš„æ”¶ç›˜ä»·å·²ç»æ˜¯å·²çŸ¥çš„å†å²æ•°æ®ï¼ˆæˆ‘ä»¬åœ¨æœˆæœ«æ”¶ç›˜åæ‰è®¡ç®—ä¿¡å·ï¼‰ã€‚ä¿¡å· `dt` æœˆæœ«ç¡®è®¤çš„ breadth å†³å®š `dt+1` æœˆçš„ä»“ä½ã€‚

âœ… **ç»“è®ºï¼šæ— å‰ç»åå·®ã€‚**

---

### æ£€æŸ¥ç‚¹ 3ï¼šGLD/GDXJ ç«äº‰æœºåˆ¶ï¼ˆ6ä¸ªæœˆåŠ¨é‡ï¼‰ âœ… **æ— å‰ç»åå·®**

**ä»£ç è·¯å¾„ï¼š** `asset_compete(sig, date, prices, thresh, frac, lb=127)`

```python
def asset_compete(sig, date, prices, thresh, frac, lb=127):
    r6  = sig['r6']
    idx = r6.index[r6.index <= date]   # â† ä¸¥æ ¼ â‰¤ date
    if len(idx) < 1: return 0.0
    d = idx[-1]                         # æœ€è¿‘çš„æ•°æ®ç‚¹ï¼ˆâ‰¤ dateï¼‰
    ...
    hist = prices.loc[:d].dropna()      # â† å†å²ä»·æ ¼
    asset_r6 = hist.iloc[-1] / hist.iloc[-lb] - 1  # ~6ä¸ªæœˆå‰
```

**åˆ†æï¼š** 
- `r6.index[r6.index <= date]` ç¡®ä¿åªç”¨ä¸æ™šäºä¿¡å·æ—¥çš„æ•°æ®
- `lb=127` çº¦ç­‰äº 6 ä¸ªæœˆäº¤æ˜“æ—¥
- GLD/GDX ä»·æ ¼æˆªå–åˆ° `d`ï¼ˆâ‰¤ dateï¼‰ä¹‹å‰ï¼Œæ— æœªæ¥æ•°æ®

âœ… **ç»“è®ºï¼šæ— å‰ç»åå·®ã€‚**

---

### æ£€æŸ¥ç‚¹ 4ï¼šåŠ¨æ€è¡Œä¸šé›†ä¸­åº¦ï¼ˆbreadth > 65% ç”¨4è¡Œä¸šï¼‰ âœ… **æ— å‰ç»åå·®**

**ä»£ç è·¯å¾„ï¼š** `select()` å‡½æ•°å†…

```python
reg     = get_regime(sig, date)   # date = dtï¼ˆæœˆæœ«ï¼‰
breadth = compute_breadth(sig, date)  # åŒä¸Šï¼Œæœˆæœ«å·²çŸ¥æ•°æ®

if reg == 'bull':
    n_bull = N_BULL_SECS_HI if breadth > BREADTH_CONC else N_BULL_SECS
    # breadth > 0.65 â†’ 4è¡Œä¸š; å¦åˆ™ â†’ 5è¡Œä¸š
```

**åˆ†æï¼š** `date` æ˜¯å½“æœˆæœ«ã€‚ç”¨å½“æœˆæœ«çš„ breadth å†³å®š**ä¸‹æœˆ**çš„è¡Œä¸šé›†ä¸­åº¦ã€‚åœ¨æœˆæœ«æ”¶ç›˜åï¼Œå½“å¤©çš„ breadth å®Œå…¨æ˜¯å·²çŸ¥çš„å†å²ä¿¡æ¯ã€‚

âœ… **ç»“è®ºï¼šæ— å‰ç»åå·®ã€‚**

---

### å‰ç»åå·®å®¡è®¡æ€»ç»“

| æ£€æŸ¥ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| æ³¢åŠ¨ç‡ç›®æ ‡åŒ–ä¿¡å· | âœ… | ä½¿ç”¨ t-3 åˆ° t-1 æœˆå†å²æ”¶ç›Š |
| å¸‚åœºå®½åº¦ Breadth | âœ… | .loc[:date] æ— æœªæ¥æ•°æ® |
| GLD/GDXJ 6måŠ¨é‡ | âœ… | r6.index <= date ä¸¥æ ¼è¿‡æ»¤ |
| åŠ¨æ€è¡Œä¸šé›†ä¸­åº¦ | âœ… | æœˆæœ«å·²çŸ¥ breadth å†³å®šä¸‹æœˆ |

**ğŸŸ¢ v9i ç­–ç•¥ä»£ç ä¸å«å‰ç»åå·®ã€‚**

---

## å®¡è®¡ä»»åŠ¡äºŒï¼šæ—¥é¢‘çœŸå®MaxDD

### æ–¹æ³•

- æœˆé¢‘è°ƒä»“é€»è¾‘å®Œæ•´ä¿ç•™
- Vol targeting scale æ¯æœˆæœ«æ›´æ–°ï¼ˆåŸºäºå†å²æœˆåº¦æ”¶ç›Šï¼‰
- æ—¥é¢‘å‡€å€¼ = æŒä»“è‚¡ç¥¨æ¯æ—¥ä»·æ ¼å˜åŠ¨åŠ æƒ
- æœªæŠ•èµ„ä½™é¢ â†’ SHYï¼ˆæ—¥é¢‘ï¼‰

### çœŸå®ç»“æœï¼ˆ2015-2025ï¼‰

| æŒ‡æ ‡ | æœˆé¢‘æŠ¥å‘Š | æ—¥é¢‘çœŸå® | ä½ä¼°å€æ•° |
|------|---------|---------|---------|
| CAGR | 31.9% | 28.2% | â€” |
| MaxDD | -10.7% | **-22.9%** | **2.14Ã—** |
| Sharpe | 1.81 | 1.25 | â€” |
| Calmar | 2.97 | 1.23 | â€” |
| Composite | 1.973 | **1.050** | â€” |

**æœ€å¤§å›æ’¤åŒºé—´ï¼š** 2020-02-20 â†’ 2020-03-20ï¼ˆCOVID-19 æš´è·Œï¼‰

### å…³é”®å‘ç°

**æœˆé¢‘å›æµ‹å¯¹ MaxDD çš„ä½ä¼°é«˜è¾¾ 2.14 å€ï¼**

åŸå› åˆ†æï¼š
1. æœˆé¢‘å›æµ‹åªçœ‹æ¯æœˆæœ«å¿«ç…§ï¼Œå®Œå…¨çœ‹ä¸åˆ°æœˆä¸­çš„æç«¯ä»·æ ¼æ³¢åŠ¨
2. COVID-19 åœ¨ 2020 å¹´ 3 æœˆä¸­æ—¬è§¦åº•ï¼Œæœˆæœ«å·²ç»éƒ¨åˆ†åå¼¹
3. æ³¢åŠ¨ç‡ç›®æ ‡åŒ–å¯¹æœˆä¸­çš„æç«¯ä¸‹è·Œæ²¡æœ‰ä¿æŠ¤ï¼ˆscale æ¯æœˆæœ«æ‰æ›´æ–°ï¼‰
4. æœˆåº¦ Sharpe è®¡ç®—ä½¿ç”¨æœˆåº¦æ”¶ç›Šæ ‡å‡†å·®ï¼Œä½ä¼°äº†æ—¥å†…æ³¢åŠ¨

**v9i vs v9gï¼ˆæ—¥é¢‘å¯¹æ¯”ï¼‰ï¼š**
- v9i æ—¥é¢‘ Composite = 1.050 **ä½äº** v9g æ—¥é¢‘ Composite = 1.146
- v9i çš„æ³¢åŠ¨ç‡ç›®æ ‡åŒ–çœ‹èµ·æ¥æ”¹å–„äº†æœˆé¢‘ Compositeï¼ˆ1.759â†’1.973ï¼‰ï¼Œä½†æ—¥é¢‘çœŸå® Composite å®é™…ä¸Šæ›´å·®ï¼
- è¿™è¡¨æ˜ vol targeting å¯¹æœˆé¢‘æŒ‡æ ‡çš„æ”¹å–„ä¸»è¦æ¥è‡ª**æœˆæœ«å¿«ç…§çš„å¹³æ»‘æ•ˆæœ**ï¼Œè€ŒéçœŸå®é£é™©é™ä½

---

## å®¡è®¡ä»»åŠ¡ä¸‰ï¼šç¨³å¥æ€§éªŒè¯

### 3.1 æ‰©å±•å›æµ‹æœŸ

**æ•°æ®å¯ç”¨æ€§ï¼š** ä¸ªè‚¡æ•°æ®æœ€æ—© 2014-06-02ï¼Œæ—  2010-2013 æ•°æ®å¯æµ‹è¯•ã€‚  
âš ï¸ æ— æ³•è¿›è¡Œ 2010-2014 æ ·æœ¬å¤–æµ‹è¯•ï¼ˆæ•°æ®é™åˆ¶ï¼‰ã€‚

### 3.2 target_vol å‚æ•°æ•æ„Ÿæ€§ï¼ˆÂ±2%ï¼‰

| å‚æ•° | CAGR | MaxDD | Composite | å˜åŒ–å¹…åº¦ |
|------|------|-------|-----------|---------|
| target_vol = 9% | 24.6% | -26.5% | 0.892 | -0.158 |
| target_vol = 11% | 28.2% | -22.9% | **1.050** | åŸºå‡† |
| target_vol = 13% | 30.3% | -26.5% | 1.031 | -0.019 |

**å‘ç°ï¼š**
- 11% çš„ target_vol åœ¨æµ‹è¯•èŒƒå›´å†…ç¡®å®æ¥è¿‘å±€éƒ¨æœ€ä¼˜
- Composite åœ¨ Â±2% å˜åŒ–æ—¶ä¸‹é™ 0.019~0.158ï¼ˆå˜åŒ–å¹…åº¦è¾ƒå¤§ï¼‰
- âš ï¸ **è¿™æç¤º target_vol å‚æ•°å¯èƒ½å­˜åœ¨ä¸€å®šç¨‹åº¦çš„è¿‡æ‹Ÿåˆé£é™©**
- 9% æ—¶ MaxDD åè€Œæ¶åŒ–ï¼ˆ-26.5%ï¼‰ï¼Œè¯´æ˜è¿‡ä½çš„ target_vol å¯èƒ½å¯¼è‡´é”™è¯¯æ—¶æœºç¼©ä»“

### 3.3 pct_scaled = 61% åˆç†æ€§åˆ†æ

**ç­–ç•¥åœ¨ 61% çš„æœˆä»½è¿›è¡Œäº†æƒç›Šç¼©å‡ï¼ˆscale < 1ï¼‰**

ä»æ—¥é¢‘æ•°æ®çœ‹ï¼š
- avg_scale = 0.774ï¼ˆå¹³å‡åªä½¿ç”¨ 77.4% çš„åä¹‰æƒç›Šä»“ä½ï¼‰
- è¿™æ„å‘³ç€çº¦ 22.6% çš„æ—¶é—´å¹³å‡æŠ•å…¥ SHY

**åˆç†æ€§åˆ¤æ–­ï¼š**
- âœ… ä»ç»Ÿè®¡è§’åº¦ï¼šå¸‚åœºæ³¢åŠ¨ç‡ç¡®å®æœ‰è¶…è¿‡ 11% çš„æ—¶å€™ï¼ˆ2018å¹´åº•ã€2020å¹´COVIDã€2022å¹´åŠ æ¯æœŸï¼‰ï¼Œè¿™äº›æ—¶æœŸç¼©ä»“æ˜¯åˆç†çš„
- âš ï¸ ä»è¿‡æ‹Ÿåˆè§’åº¦ï¼š11% çš„é˜ˆå€¼æ˜¯å›æµ‹æœŸé—´(2015-2025)åŸºç¡€ä¸Šè®¾å®šçš„ã€‚å¦‚æœçœŸå®å¸‚åœºæ³¢åŠ¨é•¿æœŸä½äº11%ï¼ˆå¦‚2017ï¼‰ï¼Œç­–ç•¥ä¼šé•¿æœŸä¸ç¼©ä»“ï¼›å¦‚æœé«˜äºï¼ˆå¦‚2022ï¼‰ï¼Œä¼šè¿‡åº¦ç¼©ä»“
- âš ï¸ 61% çš„æœˆä»½ç¼©ä»“æ¯”ä¾‹åé«˜ï¼Œå¯èƒ½æ„å‘³ç€ç­–ç•¥**ç³»ç»Ÿæ€§åœ°ä½é…è‚¡ç¥¨**ï¼Œè¿™åœ¨å®é™…æ“ä½œä¸­éœ€è¦æŠ•èµ„è€…å¿ƒç†å‡†å¤‡

---

## ç»¼åˆç»“è®º

### ç­–ç•¥çœŸå®çŠ¶å†µ

| è¯„ä¼°ç»´åº¦ | ç»“è®º |
|---------|------|
| å‰ç»åå·® | âœ… ä»£ç ä¸¥æ ¼æ— å‰ç»åå·® |
| æœˆé¢‘ MaxDD | âŒ ä¸¥é‡ä½ä¼°ï¼ˆ-10.7% vs çœŸå® -22.9%ï¼Œä½ä¼°2.14å€ï¼‰|
| æ—¥é¢‘çœŸå® Composite | âš ï¸ 1.050ï¼Œä½äº v9g æ—¥é¢‘çš„ 1.146 |
| å‚æ•°è¿‡æ‹Ÿåˆ | âš ï¸ target_vol=11% å¯èƒ½å±€éƒ¨è¿‡æ‹Ÿåˆ |
| æ•°æ®å¤–æ¨èƒ½åŠ› | âš ï¸ æ— 2010-2013æ•°æ®ï¼Œæ ·æœ¬å¤–éªŒè¯ä¸å……åˆ† |
| WF æ¯”ç‡ï¼ˆæ—¥é¢‘ï¼‰ | âœ… 0.83ï¼ˆIS Sharpe 1.35 â†’ OOS Sharpe 1.12ï¼‰|

### æŠ•èµ„å»ºè®®

1. **ä¸è¦ç›¸ä¿¡æœˆé¢‘ MaxDD -10.7%**ã€‚çœŸå®æœ€å¤§å›æ’¤çº¦ä¸º **-22.9%**ï¼Œä¸»è¦å‘ç”Ÿåœ¨ COVID-19 å´©ç›˜æœŸé—´
2. **v9i å¹¶é v9g çš„çœŸæ­£å‡çº§**ï¼šæ—¥é¢‘ Composite 1.050 < v9g æ—¥é¢‘ 1.146
3. **æ³¢åŠ¨ç‡ç›®æ ‡åŒ–çš„æœ¬è´¨**ï¼šå®ƒæœ‰æ•ˆåœ°å¹³æ»‘äº†æœˆæœ«å‡€å€¼å¿«ç…§ï¼Œä½†å¯¹æœˆä¸­çš„æç«¯äº‹ä»¶æ²¡æœ‰å³æ—¶ä¿æŠ¤
4. å¦‚æœè¿½æ±‚æ›´ä½ MaxDDï¼Œåº”è€ƒè™‘**æ—¥é¢‘æ­¢æŸæœºåˆ¶**ï¼Œè€Œéä»…ä¾é æœˆé¢‘ vol targeting

### ä¸‹ä¸€æ­¥å»ºè®®

- åœ¨ v9i æ¡†æ¶ä¸Šå åŠ æ—¥å†…æ­¢æŸï¼ˆå¦‚æœˆå†…å›æ’¤ -10% åˆ‡æ¢åˆ° SHYï¼‰ï¼Œå‚è€ƒ v9f_daily.py çš„ stop_loss æœºåˆ¶
- æµ‹è¯•æ›´é«˜é¢‘ç‡çš„ vol targeting æ›´æ–°ï¼ˆå¦‚æ¯å‘¨è€Œéæ¯æœˆï¼‰
- ç­‰å¾…çœŸå® 2024-2025 OOS æ•°æ®ç§¯ç´¯ï¼ˆç›®å‰ OOS Sharpe 1.12 vs IS 1.35ï¼ŒWF=0.83ï¼Œç®—åˆæ ¼ï¼‰

---

## é™„å½•ï¼šä»£ç å®¡è®¡å…³é”®è¡Œ

```
run_backtest() ç¬¬ 129-133 è¡Œï¼ˆvol è®¡ç®—ï¼‰ï¼š
  if len(port_returns) >= VOL_LOOKBACK:       â† ç­‰å¾…è¶³å¤Ÿå†å²
      port_vol_mon = np.std(port_returns[-VOL_LOOKBACK:], ddof=1)  â† å†å²æ•°æ®
      port_vol_ann = port_vol_mon * np.sqrt(12)
  else:
      port_vol_ann = 0.20  â† bootstrapï¼ˆéåå·®ï¼Œä½†ä¿å®ˆï¼‰

run_backtest() ç¬¬ 159 è¡Œï¼ˆè¿”å›è¿½åŠ ï¼‰ï¼š
  port_returns.append(ret)  â† åœ¨æœ¬æœˆæ”¶ç›Šå®ç°åè¿½åŠ ï¼Œä¸‹æœˆæ‰ä½¿ç”¨

ç»“è®ºï¼šæ—¶åºä¸¥æ ¼æ­£ç¡® âœ…
```

---

*å®¡è®¡æ–‡ä»¶ç”Ÿæˆï¼š`stocks/codebear/momentum_v9i_daily.py`*  
*ç»“æœæ•°æ®ï¼š`stocks/codebear/momentum_v9i_daily_results.json`*
